# 同机部署网络拓扑（WordPress 原生 + LiteLLM Docker）

> [< 上一篇：版本选择与锁定](02-版本选择与锁定.md) | [返回目录](README.md) | [下一篇：LiteLLM 部署 >](04-LiteLLM-部署（Docker-Compose）.md)

> 文档默认 LiteLLM 版本：**v1.80.11**（更新日期：**2026-01-13**）

## 推荐拓扑

- LiteLLM 端口映射为 **`127.0.0.1:24157:24157`**
- 对外域名 **`https://litellm.yourcompany.com`** 由**宿主机 Nginx/Apache** 反向代理到 `http://127.0.0.1:24157`
- PostgreSQL/Redis **不映射宿主机端口**（只在 Docker 私网）
- Prometheus/Grafana/Alertmanager 默认也仅绑定回环（本机访问或经堡垒机/VPN）

> 如果你的 WordPress 后台是 HTTPS（例如 `https://agent.xooer.com`），那么为了 iframe 嵌入 LiteLLM `/ui`，LiteLLM 的对外入口也必须是 HTTPS，否则浏览器会以 mixed content 阻止加载。

### 通配符证书注意事项（通用）

- 若证书为 `*.xooer.com`：推荐使用 `litellm.xooer.com`（✅覆盖）
- 若使用 `litellm.agent.xooer.com`：需要 `*.agent.xooer.com`（`*.xooer.com` ❌不覆盖二级子域）

## 为什么这样做

- 缩小暴露面：外网无法直连 LiteLLM API 与管理接口
- TLS/WAF/限流/审计统一放在宿主机 Web Server 层
- WordPress 与 LiteLLM 同机时，服务器端调用无需跨域（CORS 可以默认收敛）

## 相关模板

- LiteLLM 端口绑定：`../docker-compose.core.yml`
- 宿主机 Nginx 反代示例：`../nginx/litellm.conf`

