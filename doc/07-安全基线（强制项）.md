# 安全基线（强制项）

> [< 上一篇：WordPress 集成](05-WordPress-集成（企业级要点）.md) | [返回目录](README.md) | [下一篇：运维 >](08-运维（备份-升级-回滚）.md)

> 文档默认 LiteLLM 版本：**v1.80.11-stable**（更新日期：**2026-01-13**）

## 网络与暴露面（强制）

- LiteLLM `:24157` 只绑定 `127.0.0.1`（或不映射宿主机端口）
- PostgreSQL/Redis 不映射宿主机端口
- 防火墙只放行必要端口（通常 `22/80/443`）

推荐暴露面：

- **对公网**：只暴露 `443`（提供 `https://litellm.<domain>`）
- **对内**：`24157` 仅回环或仅内网（堡垒机/VPN 访问）

## 密钥治理（强制）

- **Master Key**：仅运维 bootstrap；不写入 WordPress 数据库；不出现在浏览器
- **WordPress/service key**：只给 WP 后端或内部管理服务；严格限权；可快速吊销；定期轮换
- **业务 key**：按团队/应用发放；预算+RPM+有效期；必须可审计

本仓库建议落地方式：

- 生成 service key：`sudo bash scripts/deploy-full.sh --service-key`
- 文件保存位置：`/opt/litellm-server/service-key.txt`（默认权限 600，仅 root 可读）
- WordPress 注入方式：写入 `wp-config.php` 常量（避免写入数据库）

## 反代与 iframe（强制）

如果要在 WordPress 后台 iframe 嵌入 LiteLLM `/ui`：

- WordPress 后台是 **HTTPS** → LiteLLM `/ui` 也必须是 **HTTPS**（否则 mixed content 被浏览器拦截）
- 用 CSP：`Content-Security-Policy: frame-ancestors ...`
- 不依赖 `X-Frame-Options: ALLOW-FROM`（兼容性差）
- 必要时在反代层隐藏/覆盖 `X-Frame-Options`

参考模板：`../nginx/litellm.conf`

验证命令（建议写入你的验收清单）：

```bash
curl -I https://litellm.yourcompany.com/ui/ | egrep -i "content-security-policy|x-frame-options"
```

期望：

- `Content-Security-Policy` 中包含你的 WP 域名（例如 `https://wp.example.com`）
- 不出现 `X-Frame-Options: DENY/SAMEORIGIN`

## 管理面隔离（强烈建议）

LiteLLM 的管理面通常包括：

- `/ui/`：Web UI（管理/查看）
- `/key/*`：key 管理接口（生成/列举/吊销等）
- `/api/*`：统计/分析类接口（如 analytics）

企业建议：

- `/v1/`（业务调用）可对外开放（仍需鉴权/限流/审计）
- **管理面**只允许 VPN/堡垒机/IP 白名单访问，或接入 SSO

示例（Nginx 思路：限制 `/key/` 只允许服务器本机调用；`/ui/` 允许 VPN 网段）：

```nginx
# 仅示例：请替换你的 VPN 网段 / 堡垒机出口 IP
location ^~ /key/ {
  allow 127.0.0.1;
  allow ::1;
  deny all;
  proxy_pass http://127.0.0.1:24157/key/;
}

location ^~ /ui/ {
  allow 10.0.0.0/8;
  deny all;
  proxy_pass http://127.0.0.1:24157/ui/;
}
```
